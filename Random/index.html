<html>
<head>
  <title>Random Picker</title>
  <script src="../jquery.js"></script>
	
	<style>
    .main{
      width: 800px;
      height: 600px;
    }@media (min-width: 801px){
      .main{
        margin-left: auto;
        margin-right: auto;
      }
    }
    .left{
      width: 33%;
			height: 100%;
      display: inline-block;
    }
    .right{
      width: 66%;
			height: 100%;
      display: inline-block;
			overflow: auto;
    }
		#winWrap{
			position: absolute;
			left: 0; 
  		right: 0; 
  		margin-left: auto; 
  		margin-right: auto; 
  		width: 400px;
			height: 300px;
			z-index: 10px;
		}
    #alerts {
    	position: absolute;
    	top: 5px;
    	right: 5px;
    	padding: 5px;
    	width: 300px;
    }	#alerts .alert {
  	  	border-bottom: 1px dashed #CCCCCC;
  	  	text-align: center;
  	  } #alerts .error {
  	  	background-color: #FF0000;
  	  } #alerts .success {
  	  	background-color: #00FF00;
  	  } #alerts:empty {
  	  	display:none;
    }
		#greyout{
			display: none;
			position: fixed;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			height: 100%;
			width: 100%;
			background-color: rgba(20,20,20,200);
		}
  </style>
</head>

<body>
  <div class="main">
    <div class="left">
      <textarea id="txtPeople" placeholder="Enter names here, 1 name per line" style="width: 100%; height: 90%;"></textarea>
      <button id="btnUpdate">Update</button>
    </div>
    <div class="right">
      <table id="userList">
        <thead><th>Name</th><th># Entries</th></thead>
        <tbody id="tblBod">
          <tr id="lastRow"><td><input id="txtSingle"/></td><td><button id="btnAdd">Add</button></td></tr>
        </tbody>
      </table>
    </div>
		<div><button id="btnPick">Pick Random</button></div>
		
		<div id="winWrap" style="display: none;">
			<div style="position: relative;">
				<span id="closeWin">x</span>
				<h3>The winner is...</h3>
				<h1 id="winner"></h1>
			</div>
		</div>
    <div id="alerts"></div>
  </div>
	<div id="greyout"></div>
</body>

<script>
  var userList = {};
  $("#btnAdd").click(function(e){
    addUser($("#txtSingle").val())
  });
	
	$("#btnUpdate").click(function(e){
		var list = $("#txtPeople").val();
		if($("#txtPeople").val()==""){
			msgNote("error","Enter at least one person");
		}
		list = list.split("\n")
		
		for(var i in list){
			if(list[i]!=null)
				addUser(list[i]);
		}
  });
	
	$("#btnPick").click(function(e){
		var ttl = 0;
		$(".userRow").each(function(){
			var tmp = ttl;
			ttl+=parseInt($(this).find(".numEntry").val());
			userList[$(this).attr("for")] = {min: tmp, max: ttl};
		});
		var win = Math.random() * ttl;
		for(var i in userList){
			if(userList[i].max=>win && userList[i].min<=win){
				declareWinner(i);
				return false;
			}
		}
	});
	
	$("#closeWin").click(function(e){
		$("#winner").text("");
		$("#winWrap").hide();
	});
  
	function addUser(name, num){
		if(num===undefined || num==null){
			num=1;
		}
		
		if(name===undefined || name==""){
      msgNote("error","Enter a name to add");
      return false;
    } if(userList[name]!==undefined){
      msgNote("error",name+" is already listed");
      return false;
    }
		
		userList[name] = {min: num, max: num};
    var newRow = "<tr for='"+name+"' class='userRow'><td>"+name+"</td><td><input type='numeric' class='numEntry' for='"+name+"' value='"+num+"' /></td></tr>";
    $(newRow).insertBefore("#lastRow");
	}
	
	function declareWinner(name){
		$("#winner").text(name);
		$("#winWrap").show();
		msgNote("success",name+" is the winner");
	}
	
  function msgNote(type, input){
		var alert = $("<div class='"+type+" alert'>" + input + "</div>");
		$('#alerts').append(alert);
		setTimeout(function(){
			alert.fadeOut('slow',function(){
				$(this).remove();
			});
		},3000);
}
</script>
</html>
